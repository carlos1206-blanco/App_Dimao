<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="theme-color" content="#111111">
<title>Aseo_Dimao PRO</title>
<style>
  /* --- Estilos Generales App M√≥vil --- */
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: #eee; overflow: hidden; height: 100vh; width: 100vw; }

  /* --- Mapa a pantalla completa --- */
  .map-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
  /* Aseg√∫rate de que el iframe ocupe todo el contenedor */
  iframe { border: 0; width: 100%; height: 100%; display: block; }

  /* --- Bot√≥n Men√∫ Flotante --- */
  .menu-btn {
    position: fixed; top: 15px; left: 15px;
    background: #111; color: #fff;
    width: 45px; height: 45px;
    display: flex; justify-content: center; align-items: center;
    font-size: 24px; border-radius: 50%;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    z-index: 1000; cursor: pointer; transition: transform 0.2s;
  }
  .menu-btn:active { transform: scale(0.9); }

  /* --- Men√∫ Lateral (Drawer) --- */
  .side-menu {
    position: fixed; top: 0; left: -280px;
    width: 280px; height: 100%;
    background: rgba(17, 17, 17, 0.95);
    backdrop-filter: blur(10px);
    color: #fff; padding: 20px;
    transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 2000; display: flex; flex-direction: column;
    box-shadow: 2px 0 10px rgba(0,0,0,0.5);
  }
  .side-menu.show { left: 0; }
  .side-menu h3 { margin-top: 0; font-size: 18px; opacity: 0.7; border-bottom: 1px solid #333; padding-bottom: 10px; }
  
  .side-menu ul { list-style: none; padding: 0; margin: 0; overflow-y: auto; flex: 1; }
  .side-menu li {
    padding: 12px 0; border-bottom: 1px solid #333;
    font-size: 15px; cursor: pointer; display: flex; align-items: center;
  }
  .side-menu li:active { background: #333; }

  /* Input b√∫squeda */
  #personalSearchContainer { padding: 10px 0; border-bottom: 1px solid #333; }
  #searchPersonal {
    width: 100%; padding: 10px; border-radius: 8px;
    border: none; background: #333; color: #fff; font-size: 14px;
    outline: none;
  }

  /* Overlay para cerrar men√∫ al tocar afuera */
  .overlay-bg {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.5); z-index: 1500;
    display: none; opacity: 0; transition: opacity 0.3s;
  }
  .overlay-bg.show { display: block; opacity: 1; }

  /* --- Panel Unidades (Derecha) --- */
  #panelUnidades {
    position: fixed; top: 0; right: -100%;
    width: 100%; max-width: 400px; height: 100%;
    background: #f5f5f7; color: #000;
    z-index: 2000; overflow-y: auto; padding: 15px 15px 80px 15px;
    transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: -2px 0 10px rgba(0,0,0,0.2);
  }
  #panelUnidades.show { right: 0; }
  
  .panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
  .close-panel { font-size: 24px; padding: 5px; cursor: pointer; background: #e1e1e1; border-radius: 50%; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center;}

  /* --- Tarjetas (Cards) Compactas --- */
  .card {
    background: #fff; border-radius: 12px;
    padding: 10px; margin-bottom: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  }
  .card-header { display: flex; justify-content: space-between; align-items: center; }
  .card-main-info { display: flex; align-items: center; gap: 10px; }
  .icon-people {
    width: 36px; height: 36px; border-radius: 50%;
    background: #e3f2fd; color: #007aff;
    display: flex; justify-content: center; align-items: center;
    font-size: 18px; flex-shrink: 0;
  }
  .card-texts { display: flex; flex-direction: column; }
  .card-title { font-weight: 600; font-size: 14px; color: #000; }
  .card-subtitle { font-size: 12px; color: #666; }
  
  .toggle-btn {
    background: #f0f0f3; border: none; width: 30px; height: 30px;
    border-radius: 8px; font-weight: bold; color: #007aff;
    cursor: pointer; display: flex; align-items: center; justify-content: center;
  }

  .card-details {
    display: none; background: #f9f9fc;
    padding: 10px; border-radius: 8px; margin-top: 8px;
    font-size: 13px; line-height: 1.4; color: #444;
  }
  .card-details.show { display: block; animation: slideDown 0.2s ease-out; }
  .card-details p { margin: 4px 0; }
  @keyframes slideDown { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }

  /* --- Modal Funcionario --- */
  #modalBg {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.6); backdrop-filter: blur(4px);
    display: none; align-items: center; justify-content: center;
    z-index: 99999; opacity: 0; transition: opacity 0.2s;
  }
  #modalBg.show { opacity: 1; }
  
  #modalCard {
    background: #fff; width: 85%; max-width: 340px;
    border-radius: 16px; padding: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    position: relative; transform: scale(0.9); transition: transform 0.2s;
  }
  #modalBg.show #modalCard { transform: scale(1); }

  #closeModal {
    position: absolute; top: 10px; right: 10px;
    width: 30px; height: 30px; background: #f0f0f3;
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    cursor: pointer; font-size: 14px; color: #555;
  }
  .modal-content h2 { margin: 0 0 5px 0; font-size: 18px; color: #111; }
  .modal-content h4 { margin: 0 0 15px 0; font-size: 14px; color: #666; font-weight: normal; }
  .modal-row { display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding: 8px 0; font-size: 13px; }
  .modal-row strong { color: #333; }
  .modal-row span { color: #555; text-align: right; max-width: 60%; }

</style>
</head>
<body>

<div class="map-container">
  <iframe src=<iframe src="https://www.google.com/maps/d/u/0/embed?mid=16kUDVecW-2uOYXUZGlDrd9cESOIUnSE&ehbc=2E312F" width="640" height="480"> allowfullscreen></iframe>
</div>

<div class="overlay-bg" id="overlayBg"></div>

<div class="menu-btn" id="btnMenu">‚ò∞</div>

<div class="side-menu" id="sideMenu">
  <h3>DIMAO PRO</h3>
  <ul>
    <li onclick="alert('El control de Capas est√° DENTRO del mapa (por seguridad de Google). Presiona el bot√≥n de Capas/Expandir en la esquina del mapa.')">üó∫Ô∏è Capas (Usar control del Mapa)</li>
    <li id="btnPersonal">üë• Personal (Buscar) ‚ñæ</li>
  </ul>
  
  <div id="personalSearchContainer" style="display:none;">
    <input id="searchPersonal" type="text" placeholder="Escribe nombre...">
  </div>
  
  <ul id="submenuPersonal" style="display:none; flex:1; overflow-y:auto;">
    <li style="color:#777; font-size:12px; padding:10px;">Cargando lista...</li>
  </ul>

  <ul>
    <li id="btnUnidades">üóÇÔ∏è Unidades Operativas</li>
    <li onclick="alert('Secci√≥n en desarrollo')">üìä Estad√≠sticas</li>
  </ul>
  <div style="margin-top:auto; font-size:11px; color:#555; text-align:center;">Versi√≥n 2.1</div>
</div>

<div id="panelUnidades">
  <div class="panel-header">
    <h3 style="margin:0">Unidades</h3>
    <div class="close-panel" id="closeUnidades">‚úï</div>
  </div>

  <div class="card">
    <div class="card-header">
      <div class="card-main-info">
        <div class="icon-people">üìÅ</div>
        <div class="card-texts">
          <span class="card-title">Administrativo</span>
          <span class="card-subtitle">10 personas</span>
        </div>
      </div>
      <button class="toggle-btn" data-target="#unidad-0">+</button>
    </div>
    <div class="card-details" id="unidad-0">
      <p><strong>Encargado:</strong> Sebasti√°n Carrillo</p>
      <p><strong>Funciones:</strong> Atenci√≥n, tickets, log√≠stica, compras, remuneraciones.</p>
      <p><strong>Horario:</strong> Lu-Vi 08:30 - 17:20</p>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <div class="card-main-info">
        <div class="icon-people">üßπ</div>
        <div class="card-texts">
          <span class="card-title">Aseo Comunal y Cuneteo</span>
          <span class="card-subtitle">68 personas</span>
        </div>
      </div>
      <button class="toggle-btn" data-target="#unidad-1">+</button>
    </div>
    <div class="card-details" id="unidad-1">
      <p><strong>Encargado:</strong> Sebasti√°n Carrillo</p>
      <p><strong>Funciones:</strong> Barrido y cuneteo avenidas principales.</p>
      <p><strong>Horario:</strong> Lu-Vi 08:00-17:20 | Sab 08:30-12:30</p>
      <p><strong>Observaci√≥n:</strong> S√°bado solo 8 personas. Verano 07:00-15:00.</p>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <div class="card-main-info">
        <div class="icon-people">üöõ</div>
        <div class="card-texts">
          <span class="card-title">Barrido Mecanizado</span>
          <span class="card-subtitle">4 personas</span>
        </div>
      </div>
      <button class="toggle-btn" data-target="#unidad-2">+</button>
    </div>
    <div class="card-details" id="unidad-2">
      <p><strong>Funciones:</strong> Operaci√≥n cami√≥n barredor.</p>
      <p><strong>Horario:</strong> Lu-Vi 07:00 - 23:00</p>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <div class="card-main-info">
        <div class="icon-people">üçé</div>
        <div class="card-texts">
          <span class="card-title">RSD Ferias</span>
          <span class="card-subtitle">2 personas</span>
        </div>
      </div>
      <button class="toggle-btn" data-target="#unidad-3">+</button>
    </div>
    <div class="card-details" id="unidad-3">
      <p><strong>Funciones:</strong> Limpieza post ferias libres.</p>
      <p><strong>Horario:</strong> Ma-Do 15:00 - 20:00 / 22:00</p>
    </div>
  </div>
  
  <div class="card">
    <div class="card-header">
      <div class="card-main-info">
        <div class="icon-people">üóëÔ∏è</div>
        <div class="card-texts">
          <span class="card-title">RSD Domiciliario</span>
          <span class="card-subtitle">5 personas</span>
        </div>
      </div>
      <button class="toggle-btn" data-target="#unidad-4">+</button>
    </div>
    <div class="card-details" id="unidad-4">
      <p><strong>Funciones:</strong> Supervisi√≥n recolecci√≥n basura.</p>
      <p><strong>Horario:</strong> Lu-Sa 08:30 - 17:20 (Sab hasta 13:00)</p>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <div class="card-main-info">
        <div class="icon-people">üèôÔ∏è</div>
        <div class="card-texts">
          <span class="card-title">Aseo Centro</span>
          <span class="card-subtitle">31 personas</span>
        </div>
      </div>
      <button class="toggle-btn" data-target="#unidad-5">+</button>
    </div>
    <div class="card-details" id="unidad-5">
      <p><strong>Funciones:</strong> Barrido centro y plazas.</p>
      <p><strong>Horario:</strong> Turnos rotativos 07:00 - 22:00</p>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <div class="card-main-info">
        <div class="icon-people">üåô</div>
        <div class="card-texts">
          <span class="card-title">Aseo Nocturno</span>
          <span class="card-subtitle">9 personas</span>
        </div>
      </div>
      <button class="toggle-btn" data-target="#unidad-6">+</button>
    </div>
    <div class="card-details" id="unidad-6">
      <p><strong>D√≠as:</strong> Lunes a Domingo</p>
      <p><strong>Horario:</strong> 21:00 a 04:00</p>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <div class="card-main-info">
        <div class="icon-people">üöø</div>
        <div class="card-texts">
          <span class="card-title">Lavado de Aceras</span>
          <span class="card-subtitle">5 personas</span>
        </div>
      </div>
      <button class="toggle-btn" data-target="#unidad-7">+</button>
    </div>
    <div class="card-details" id="unidad-7">
      <p><strong>D√≠as:</strong> Domingo a Jueves</p>
      <p><strong>Horario:</strong> 21:00 a 04:00</p>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <div class="card-main-info">
        <div class="icon-people">üè≠</div>
        <div class="card-texts">
          <span class="card-title">Sobreproducci√≥n</span>
          <span class="card-subtitle">5 personas</span>
        </div>
      </div>
      <button class="toggle-btn" data-target="#unidad-8">+</button>
    </div>
    <div class="card-details" id="unidad-8">
      <p><strong>Funciones:</strong> Gesti√≥n locales > 1800 L/mes.</p>
      <p><strong>Horario:</strong> Lu-Vi 08:15 a 17:20</p>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <div class="card-main-info">
        <div class="icon-people">üåú</div>
        <div class="card-texts">
          <span class="card-title">RSD Nocturno</span>
          <span class="card-subtitle">1 persona</span>
        </div>
      </div>
      <button class="toggle-btn" data-target="#unidad-9">+</button>
    </div>
    <div class="card-details" id="unidad-9">
      <p><strong>D√≠as:</strong> Lunes a Domingo</p>
      <p><strong>Horario:</strong> 18:00 a 02:00</p>
    </div>
  </div>

</div>

<div id="modalBg">
  <div id="modalCard">
    <div id="closeModal">‚úï</div>
    <div id="modalContent" class="modal-content"></div>
  </div>
</div>

<script>
/* --- L√≥gica Men√∫s --- */
const btnMenu = document.getElementById("btnMenu");
const sideMenu = document.getElementById("sideMenu");
const overlayBg = document.getElementById("overlayBg");
const panelUnidades = document.getElementById("panelUnidades");
const btnUnidades = document.getElementById("btnUnidades");
const closeUnidades = document.getElementById("closeUnidades");

function toggleMenu(show) {
  if(show) {
    sideMenu.classList.add('show');
    overlayBg.classList.add('show');
  } else {
    sideMenu.classList.remove('show');
    panelUnidades.classList.remove('show');
    overlayBg.classList.remove('show');
  }
}
btnMenu.onclick = () => toggleMenu(true);
overlayBg.onclick = () => toggleMenu(false);

btnUnidades.onclick = () => {
  sideMenu.classList.remove('show');
  panelUnidades.classList.add('show');
  overlayBg.classList.add('show');
};
closeUnidades.onclick = () => {
  panelUnidades.classList.remove('show');
  overlayBg.classList.remove('show');
};

/* --- L√≥gica Acorde√≥n --- */
document.querySelectorAll('.toggle-btn').forEach(b => {
  b.onclick = () => {
    let t = document.querySelector(b.dataset.target);
    let isOpen = t.classList.contains('show');
    if(!isOpen) {
      t.classList.add('show');
      b.textContent = "‚àí"; b.style.color = "red";
    } else {
      t.classList.remove('show');
      b.textContent = "+"; b.style.color = "#007aff";
    }
  };
});

/* --- L√≥gica Personal (Mantiene tu enlace a Google Sheets) --- */
const btnPersonal = document.getElementById("btnPersonal");
const submenuPersonal = document.getElementById("submenuPersonal");
const searchBox = document.getElementById("personalSearchContainer");

btnPersonal.onclick = () => {
  let isVisible = submenuPersonal.style.display === "block";
  submenuPersonal.style.display = isVisible ? "none" : "block";
  searchBox.style.display = isVisible ? "none" : "block";
  if (!isVisible && !window._rows) cargarPersonal();
};

async function cargarPersonal() {
  try {
    // Este enlace apunta a tu CSV publicado de Google Sheets
    const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRe9KYpZHsb2Wnc5nYXNSGgHfhdq8-iEPjh8CmlnPewhm6xdB6BQbFLsiIi2SlnnABaU8nEalZobyl1/pub?output=csv";
    const resp = await fetch(url);
    const txt = await resp.text();
    const rows = txt.trim().split("\n").map(r => r.split(","));
    window._rows = rows;
    renderLista(rows);
  } catch (e) {
    submenuPersonal.innerHTML = "<li style='color:red; padding:10px;'>Error cargando datos. Aseg√∫rate que la hoja de c√°lculo est√© Publicada.</li>";
  }
}

function renderLista(rows) {
  submenuPersonal.innerHTML = "";
  for(let i=1; i<rows.length; i++) {
    if(rows[i][0]) {
      let li = document.createElement("li");
      let nombre = `${rows[i][0]} ${rows[i][1]} ${rows[i][2]}`.replace(/undefined/g,'');
      li.textContent = nombre;
      li.onclick = () => abrirModalFuncionario(rows[i]);
      submenuPersonal.appendChild(li);
    }
  }
}

document.getElementById("searchPersonal").oninput = function() {
  let filtro = this.value.toLowerCase();
  let items = submenuPersonal.getElementsByTagName("li");
  for (let item of items) {
    item.style.display = item.textContent.toLowerCase().includes(filtro) ? "flex" : "none";
  }
};

/* --- Modal Funcionario --- */
const modalBg = document.getElementById("modalBg");
const modalContent = document.getElementById("modalContent");
const closeModal = document.getElementById("closeModal");

function abrirModalFuncionario(data) {
  // Se asume el mismo orden de columnas que ten√≠as:
  // [0] Nombre1, [1] Nombre2, [2] Apellido, [3] RUT, [4] Edad, [5] F.Nac, [6] Mutual, [7] Tel, [8] Dir, [9] Emergencia, [10] Salud, [11] Contrato
  let html = `
    <h2>${data[0]} ${data[1]}</h2>
    <h4>${data[2] || ''}</h4>
    <div class="modal-row"><strong>RUT:</strong> <span>${data[3]}</span></div>
    <div class="modal-row"><strong>Edad:</strong> <span>${data[4]}</span></div>
    <div class="modal-row"><strong>F. Nac:</strong> <span>${data[5]}</span></div>
    <div class="modal-row"><strong>Mutual:</strong> <span>${data[6]}</span></div>
    <div class="modal-row"><strong>Tel√©fono:</strong> <span style="color:#007aff">${data[7]}</span></div>
    <div class="modal-row"><strong>Direcci√≥n:</strong> <span>${data[8]}</span></div>
    <div class="modal-row"><strong>Emergencia:</strong> <span>${data[9]}</span></div>
    <div class="modal-row"><strong>Salud:</strong> <span>${data[10] || '-'}</span></div>
    <div class="modal-row"><strong>Contrato:</strong> <span>${data[11]}</span></div>
  `;
  modalContent.innerHTML = html;
  modalBg.style.display = "flex";
  setTimeout(() => modalBg.classList.add('show'), 10);
  toggleMenu(false);
}

closeModal.onclick = () => {
  modalBg.classList.remove('show');
  setTimeout(() => modalBg.style.display = "none", 200);
};
modalBg.onclick = (e) => {
  if(e.target === modalBg) closeModal.click();
}
</script>

</body>
</html>



















